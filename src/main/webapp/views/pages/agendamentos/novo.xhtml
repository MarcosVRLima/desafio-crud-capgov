<!DOCTYPE html>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:pt="http://xmlns.jcp.org/jsf/passthrough"
                template="/views/template.xhtml">

	<!-- Título da aba -->
	<ui:define name="title">Novo Agendamento</ui:define>

	<!-- Miolo da página vai no slot 'content' do template -->
	<ui:define name="content">
		<div class="mt-4">
			<h2 class="mb-3">Cadastrar Agendamento</h2>

			<h:form styleClass="row g-3" id="formAgendamento">
				<h:messages globalOnly="true" styleClass="alert alert-danger"
					layout="table" />

				<!-- Paciente -->
				<div class="col-md-6">
					<h:outputLabel for="paciente" value="Paciente" styleClass="form-label" />
					<div class="input-group">
						<h:inputText id="paciente" value="#{agendamentoBean.pacientePessoa.nome}"
							readonly="true" styleClass="form-control" />
						<button type="button" class="btn btn-outline-primary"
							data-bs-toggle="modal" data-bs-target="#modalPacientes">
							Selecionar
						</button>
					</div>
				</div>

				<!-- Médico -->
				<div class="col-md-6">
					<h:outputLabel for="medico" value="Médico" styleClass="form-label" />
					<div class="input-group">
						<h:inputText id="medico" value="#{agendamentoBean.medicoPessoa.nome}"
							readonly="true" styleClass="form-control" />
						<button type="button" class="btn btn-outline-primary"
							data-bs-toggle="modal" data-bs-target="#modalMedicos">
							Selecionar
						</button>
					</div>
				</div>

				<!-- Data -->
		        <div class="col-md-6">
		          <h:outputLabel for="data" value="Data" styleClass="form-label" />
		          <h:inputText id="data" value="#{agendamentoBean.data}" required="true"
		                       styleClass="form-control"
		                       pt:type="date" />
		        </div>
		
		        <!-- Hora -->
		        <div class="col-md-6">
		          <h:outputLabel for="hora" value="Hora" styleClass="form-label" />
		          <h:inputText id="hora" value="#{agendamentoBean.hora}" required="true"
		                       styleClass="form-control"
		                       pt:type="time" pt:step="60" />
		        </div>

				<!-- Ações -->
				<div class="col-12 d-flex gap-2 mt-2">
					<h:commandButton value="Salvar" action="#{agendamentoBean.salvar}"
						styleClass="btn btn-primary" />
					<h:link outcome="agendamento" value="Cancelar"
						styleClass="btn btn-secondary" />
				</div>
			</h:form>
		</div>

		<!-- Modal Seleção de Pacientes -->
		<div class="modal fade" id="modalPacientes" tabindex="-1"
			aria-labelledby="modalPacientesLabel" aria-hidden="true">
			<div class="modal-dialog modal-lg">
				<div class="modal-content">
					<div class="modal-header">
						<h5 class="modal-title" id="modalPacientesLabel">Selecionar
							Paciente</h5>
						<button type="button" class="btn-close" data-bs-dismiss="modal"
							aria-label="Fechar"></button>
					</div>
					<div class="modal-body">
						<h:dataTable value="#{agendamentoBean.pacientes}" var="p"
							styleClass="table table-striped">
							<h:column>
								<f:facet name="header">Nome</f:facet>
								#{p.nome}
							</h:column>
							<h:column>
								<f:facet name="header">Ações</f:facet>
								<h:commandButton value="Selecionar"
								    action="#{agendamentoBean.selecionarPaciente(p)}"
								    styleClass="btn btn-sm btn-success">
								    
								    <f:ajax execute="@this" render=":formAgendamento:paciente"
								            onevent="function(data) {
								                if (data.status === 'success') {
								                    var myModal = bootstrap.Modal.getInstance(document.getElementById('modalPacientes'));
								                    myModal.hide();
								                }
								            }"/>
								</h:commandButton>

							</h:column>
						</h:dataTable>
					</div>
				</div>
			</div>
		</div>

		<!-- Modal Seleção de Médicos -->
		<div class="modal fade" id="modalMedicos" tabindex="-1"
			aria-labelledby="modalMedicosLabel" aria-hidden="true">
			<div class="modal-dialog modal-lg">
				<div class="modal-content">
					<div class="modal-header">
						<h5 class="modal-title" id="modalMedicosLabel">Selecionar
							Médico</h5>
						<button type="button" class="btn-close" data-bs-dismiss="modal"
							aria-label="Fechar"></button>
					</div>
					<div class="modal-body">
						<h:dataTable value="#{agendamentoBean.medicos}" var="m"
							styleClass="table table-striped">
							<h:column>
								<f:facet name="header">Nome</f:facet>
								#{m.nome}
							</h:column>
							<h:column>
								<f:facet name="header">Ações</f:facet>
								<h:commandButton value="Selecionar"
			    action="#{agendamentoBean.selecionarMedico(m)}"
			    styleClass="btn btn-sm btn-success">
			    
			    <f:ajax execute="@this" render=":formAgendamento:medico"
			            onevent="function(data) {
			                if (data.status === 'success') {
			                    var myModal = bootstrap.Modal.getInstance(document.getElementById('modalMedicos'));
			                    myModal.hide();
			                }
			            }"/>
			</h:commandButton>

							</h:column>
						</h:dataTable>
					</div>
				</div>
			</div>
		</div>
	</ui:define>
</ui:composition>
